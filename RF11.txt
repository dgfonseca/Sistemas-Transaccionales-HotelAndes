//REQUERIMIENTO DE CONSULTA 11
//PARA TODAS LAS SEMANAS DEL AÑO (DE SÀBADO A SÀBADO) ENCONTRAR LOS SERVICIOS MÀS Y MENOS 
//SOLICITADAS, Y LAS HABITACIONES MÀS Y MENOS SOLICITADAS





//SERVICIOS UTILIZADOS POR USUARIO
SELECT RESP.NOMBRE, SUM(RESP.NUMEROVECES) AS TOTALVECES
FROM(
        SELECT COUNT(SER.ID) AS NUMEROVECES, SER.NOMBRE,  SIR.FECHAUSO
        FROM SERVICIOS SER, SIRVEN SIR
        WHERE SER.ID = SIR.IDSERVICIO AND SIR.FECHAUSO BETWEEN '2019010100' AND '2019010823'
        GROUP BY SIR.FECHAUSO, SER.NOMBRE
    )RESP
GROUP BY RESP.NOMBRE
ORDER BY TOTALVECES DESC






//SERVICIOS UTILIZADOS POR CONVENCION
SELECT SER.ID, SER.NOMBRE, COUNT(RESC.ID) AS NUMEROVECES
FROM SERVICIOS SER, SERVICIOS_CONVENCION SERC, RESERVA_CONVENCIONES RESC
WHERE SER.ID = SERC.ID_RESERVA AND SERC.ID_RESERVA = RESC.ID
 AND ((RESC.FECHAINICIO BETWEEN '20190301' AND '20190820') OR (RESC.FECHAFIN BETWEEN '20190301' AND '20190820'))
GROUP BY SER.ID, SER.NOMBRE
ORDER BY NUMEROVECES DESC


//SERVICIOS EN CONJUNTO EN FECHA DADA
SELECT TOT.ID, TOT.NOMBRE, SUM(NUMVECES) AS TOTALVECES
FROM (
        SELECT RESP.ID, RESP.NOMBRE, SUM(RESP.NUMEROVECES) AS NUMVECES
        FROM(
                SELECT SER.ID, COUNT(SER.ID) AS NUMEROVECES, SER.NOMBRE,  SIR.FECHAUSO
                FROM SERVICIOS SER, SIRVEN SIR
                WHERE SER.ID = SIR.IDSERVICIO AND SIR.FECHAUSO BETWEEN '2019010100' AND '2019010823'
                GROUP BY SIR.FECHAUSO, SER.NOMBRE, SER.ID
            )RESP
        GROUP BY RESP.ID, RESP.NOMBRE
            
        UNION ALL
        
        SELECT SER.ID, SER.NOMBRE, COUNT(RESC.ID) AS NUMEROVECES
        FROM SERVICIOS SER, SERVICIOS_CONVENCION SERC, RESERVA_CONVENCIONES RESC
        WHERE SER.ID = SERC.ID_RESERVA AND SERC.ID_RESERVA = RESC.ID
         AND ((RESC.FECHAINICIO BETWEEN '20190301' AND '20190820') OR (RESC.FECHAFIN BETWEEN '20190301' AND '20190820'))
        GROUP BY SER.ID, SER.NOMBRE
    )TOT
GROUP BY TOT.ID, TOT.NOMBRE
ORDER BY TOTALVECES DESC








//HABITACIONES 
SELECT RESP.NUMEROHABITACION, COUNT(ID) AS NUMEROVECES
FROM(
        SELECT AP.NUMEROHABITACION, RES.ID, RES.FECHAINICIO, RES.FECHAFIN
        FROM APARTAN AP, RESERVA RES
        WHERE AP.IDRESERVA = RES.ID 
            AND ((RES.FECHAINICIO BETWEEN '20181010' AND '20181020') OR (RES.FECHAFIN BETWEEN '20181010' AND '20181020'))
        
        UNION ALL
        
        SELECT HABC.NUMEROHABITACION, RESC.ID, RESC.FECHAINICIO, RESC.FECHAFIN
        FROM HABITACION_CONVENCION HABC, RESERVA_CONVENCIONES RESC
        WHERE HABC.ID_RESERVA = RESC.ID 
             AND ((RESC.FECHAINICIO BETWEEN '20181010' AND '20181020') OR (RESC.FECHAFIN BETWEEN '20181010' AND '20181020'))
    ) RESP
GROUP BY RESP.NUMEROHABITACION
ORDER BY NUMEROVECES DESC